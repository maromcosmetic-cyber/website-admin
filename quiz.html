<div id="marom-quiz" class="mq">
  <div class="mq-bg">
    <div class="mq-shell">

      <!-- Header -->

      <header class="mq-head" aria-live="polite">
        <div class="mq-brand">

          <span class="mq-badge">MAROM</span>

          <span class="mq-sub">Hair Balance Quiz</span>

        </div>
        <h1 class="mq-title">Why is my hair falling out?</h1>
        <p class="mq-lead">Get an AI-powered personalized analysis with a gentle, natural plan tailored to your unique
          hair pattern.</p>

        <div class="mq-progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"
          aria-label="Quiz progress">
          <div class="mq-progress__bar" style="width: 0%;"></div>
        </div>
        <div class="mq-meta"><span id="mq-steptext" class="mq-steptext">Step 1 of 8</span>
          <span class="mq-time">~90 seconds</span>
        </div>
      </header><!-- Main -->

      <main class="mq-card" role="region" aria-label="Hair loss quiz">
        <!-- Start screen -->
      </main>
      <section class="mq-panel mq-panel--active" data-step="start">
        <div class="mq-hero">
          <div class="mq-hero__icon" aria-hidden="true"></div>
          <div>
            <h2 class="mq-h2">AI-Powered Hair Loss Analysis</h2>
            <p class="mq-text">Our advanced AI analyzes your unique answers to identify your hair loss pattern and
              create a personalized plan tailored just for you. Get instant insights, product recommendations, and a
              custom routine.</p>

            <ul class="mq-bullets">
              <li>ü§ñ AI-powered personalized analysis</li>
              <li>üìã Customized hair care routine</li>
              <li>‚ú® Product recommendations matched to your pattern</li>
              <li>üí° Personalized insights &amp; nutrition tips</li>
              <li>üåø Gentle, natural approach</li>
            </ul>
          </div>
        </div>
        <div class="mq-actions"><button class="mq-btn mq-btn--primary" data-action="start">Start the quiz</button></div>
        <p class="mq-footnote">Tip: Answer based on the last <strong>4‚Äì8 weeks</strong>.</p>

      </section><!-- Question template panels -->

      <!-- Gender Selection -->

      <section class="mq-panel" data-step="gender">
        <h3 class="mq-q">To personalize your hair care plan, please tell us:</h3>
        <p class="mq-qhint">This helps us provide the most relevant recommendations for you.</p>

        <div class="mq-options" role="listbox" aria-label="Choose one option"><button class="mq-opt" data-value="woman"
            data-tags="">Woman</button>
          <button class="mq-opt" data-value="man" data-tags="">Man</button>
        </div>
      </section><!-- Women's Questions -->

      <section class="mq-panel" data-step="1" data-gender="woman">
        <h3 class="mq-q">When did you first notice more hair fall?</h3>
        <p class="mq-qhint">Pick the closest match.</p>

        <div class="mq-options" role="listbox" aria-label="Choose one option"><button class="mq-opt"
            data-value="postpartum" data-tags="hormonal">After pregnancy / postpartum</button>
          <button class="mq-opt" data-value="stress" data-tags="stress">After stress / burnout</button>
          <button class="mq-opt" data-value="gradual" data-tags="structure scalp">Gradually over time</button>
          <button class="mq-opt" data-value="sudden" data-tags="stress scalp">Sudden &amp; recent</button>
          <button class="mq-opt" data-value="unsure" data-tags="scalp">I‚Äôm not sure</button>
        </div>
      </section>
      <section class="mq-panel" data-step="2" data-gender="woman">
        <h3 class="mq-q">How does your scalp feel most days?</h3>
        <p class="mq-qhint">Your scalp is skin ‚Äî it matters.</p>

        <div class="mq-options"><button class="mq-opt" data-value="tight" data-tags="scalp structure">Tight /
            dry</button>
          <button class="mq-opt" data-value="itchy" data-tags="scalp">Itchy / sensitive</button>
          <button class="mq-opt" data-value="oily" data-tags="scalp">Oily quickly</button>
          <button class="mq-opt" data-value="balanced" data-tags="structure">Balanced / normal</button>
          <button class="mq-opt" data-value="never" data-tags="scalp">Never thought about it</button>
        </div>
      </section>
      <section class="mq-panel" data-step="3" data-gender="woman">
        <h3 class="mq-q">How often do you wash your hair?</h3>
        <p class="mq-qhint">This helps detect stripping vs. buildup.</p>

        <div class="mq-options"><button class="mq-opt" data-value="daily" data-tags="scalp">Daily</button>
          <button class="mq-opt" data-value="2-3" data-tags="structure scalp">Every 2‚Äì3 days</button>
          <button class="mq-opt" data-value="twice" data-tags="structure">Twice a week</button>
          <button class="mq-opt" data-value="rarely" data-tags="scalp">Rarely</button>
          <button class="mq-opt" data-value="varies" data-tags="scalp">It changes a lot</button>
        </div>
      </section>
      <section class="mq-panel" data-step="4" data-gender="woman">
        <h3 class="mq-q">Which feels most true right now?</h3>
        <p class="mq-qhint">Choose what bothers you most.</p>

        <div class="mq-options"><button class="mq-opt" data-value="thinner" data-tags="structure hormonal">My hair used
            to be thicker</button>
          <button class="mq-opt" data-value="breaks" data-tags="structure">It breaks easily</button>
          <button class="mq-opt" data-value="dry" data-tags="structure scalp">Dry, rough, lifeless</button>
          <button class="mq-opt" data-value="scalpstressed" data-tags="scalp stress">My scalp feels ‚Äústressed‚Äù</button>
          <button class="mq-opt" data-value="growth" data-tags="hormonal structure">It doesn‚Äôt grow like before</button>
        </div>
      </section>
      <section class="mq-panel" data-step="5" data-gender="woman">
        <h3 class="mq-q">Have you tried hair-loss treatments before?</h3>
        <p class="mq-qhint">Be honest ‚Äî no judgement.</p>

        <div class="mq-options"><button class="mq-opt" data-value="strong" data-tags="scalp">Yes, strong
            treatments</button>
          <button class="mq-opt" data-value="natural" data-tags="structure">Mostly oils / masks</button>
          <button class="mq-opt" data-value="stopped" data-tags="stress scalp">Tried, then stopped</button>
          <button class="mq-opt" data-value="afraid" data-tags="scalp">No, afraid to make it worse</button>
        </div>
      </section>
      <section class="mq-panel" data-step="6" data-gender="woman">
        <h3 class="mq-q">How's your energy lately?</h3>
        <p class="mq-qhint">Hair shedding often tracks the nervous system.</p>

        <div class="mq-options"><button class="mq-opt" data-value="calm" data-tags="structure">Calm &amp;
            balanced</button>
          <button class="mq-opt" data-value="busy" data-tags="stress">Busy but manageable</button>
          <button class="mq-opt" data-value="stressful" data-tags="stress">Stressful</button>
          <button class="mq-opt" data-value="exhausted" data-tags="stress hormonal">Exhausted</button>
          <button class="mq-opt" data-value="recovering" data-tags="hormonal stress">Recovering from a big
            change</button>
        </div>
      </section>
      <section class="mq-panel" data-step="7" data-gender="woman">
        <h3 class="mq-q">Are you in a postpartum period right now?</h3>
        <p class="mq-qhint">This helps personalize your plan.</p>

        <div class="mq-options"><button class="mq-opt" data-value="pp_yes" data-tags="hormonal">Yes (0‚Äì12 months
            postpartum)</button>
          <button class="mq-opt" data-value="pp_no" data-tags="structure">No</button>
          <button class="mq-opt" data-value="pp_unsure" data-tags="hormonal">Not sure / complicated</button>
        </div>
      </section><!-- Men's Questions -->

      <section class="mq-panel" style="display: none;" data-step="1" data-gender="man">
        <h3 class="mq-q">When did you first notice more hair fall or thinning?</h3>
        <p class="mq-qhint">Pick the closest match.</p>

        <div class="mq-options" role="listbox" aria-label="Choose one option"><button class="mq-opt"
            data-value="gradual" data-tags="structure scalp">Gradually over time (pattern thinning)</button>
          <button class="mq-opt" data-value="stress" data-tags="stress">After stress / major life change</button>
          <button class="mq-opt" data-value="sudden" data-tags="stress scalp">Sudden &amp; recent</button>
          <button class="mq-opt" data-value="receding" data-tags="structure">Receding hairline / temples</button>
          <button class="mq-opt" data-value="unsure" data-tags="scalp">I'm not sure</button>
        </div>
      </section>
      <section class="mq-panel" style="display: none;" data-step="2" data-gender="man">
        <h3 class="mq-q">How does your scalp feel most days?</h3>
        <p class="mq-qhint">Your scalp health matters for hair growth.</p>

        <div class="mq-options"><button class="mq-opt" data-value="tight" data-tags="scalp structure">Tight /
            dry</button>
          <button class="mq-opt" data-value="itchy" data-tags="scalp">Itchy / sensitive</button>
          <button class="mq-opt" data-value="oily" data-tags="scalp">Oily quickly</button>
          <button class="mq-opt" data-value="balanced" data-tags="structure">Balanced / normal</button>
          <button class="mq-opt" data-value="never" data-tags="scalp">Never thought about it</button>
        </div>
      </section>
      <section class="mq-panel" style="display: none;" data-step="3" data-gender="man">
        <h3 class="mq-q">How often do you wash your hair?</h3>
        <p class="mq-qhint">This helps detect stripping vs. buildup.</p>

        <div class="mq-options"><button class="mq-opt" data-value="daily" data-tags="scalp">Daily</button>
          <button class="mq-opt" data-value="2-3" data-tags="structure scalp">Every 2‚Äì3 days</button>
          <button class="mq-opt" data-value="twice" data-tags="structure">Twice a week</button>
          <button class="mq-opt" data-value="rarely" data-tags="scalp">Rarely</button>
          <button class="mq-opt" data-value="varies" data-tags="scalp">It changes a lot</button>
        </div>
      </section>
      <section class="mq-panel" style="display: none;" data-step="4" data-gender="man">
        <h3 class="mq-q">Which feels most true right now?</h3>
        <p class="mq-qhint">Choose what bothers you most.</p>

        <div class="mq-options"><button class="mq-opt" data-value="thinner" data-tags="structure hormonal">My hair used
            to be thicker</button>
          <button class="mq-opt" data-value="breaks" data-tags="structure">It breaks easily</button>
          <button class="mq-opt" data-value="dry" data-tags="structure scalp">Dry, rough, lifeless</button>
          <button class="mq-opt" data-value="scalpstressed" data-tags="scalp stress">My scalp feels "stressed"</button>
          <button class="mq-opt" data-value="receding" data-tags="structure hormonal">Receding hairline / crown
            thinning</button>
        </div>
      </section>
      <section class="mq-panel" style="display: none;" data-step="5" data-gender="man">
        <h3 class="mq-q">Have you tried hair-loss treatments before?</h3>
        <p class="mq-qhint">Be honest ‚Äî no judgement.</p>

        <div class="mq-options"><button class="mq-opt" data-value="strong" data-tags="scalp">Yes, strong treatments
            (minoxidil, finasteride, etc.)</button>
          <button class="mq-opt" data-value="natural" data-tags="structure">Mostly oils / natural products</button>
          <button class="mq-opt" data-value="stopped" data-tags="stress scalp">Tried, then stopped</button>
          <button class="mq-opt" data-value="afraid" data-tags="scalp">No, afraid to make it worse</button>
        </div>
      </section>
      <section class="mq-panel" style="display: none;" data-step="6" data-gender="man">
        <h3 class="mq-q">How's your energy and stress level lately?</h3>
        <p class="mq-qhint">Stress and lifestyle can impact hair health.</p>

        <div class="mq-options"><button class="mq-opt" data-value="calm" data-tags="structure">Calm &amp;
            balanced</button>
          <button class="mq-opt" data-value="busy" data-tags="stress">Busy but manageable</button>
          <button class="mq-opt" data-value="stressful" data-tags="stress">Stressful</button>
          <button class="mq-opt" data-value="exhausted" data-tags="stress hormonal">Exhausted</button>
          <button class="mq-opt" data-value="recovering" data-tags="hormonal stress">Recovering from a big
            change</button>
        </div>
      </section>
      <section class="mq-panel" style="display: none;" data-step="7" data-gender="man">
        <h3 class="mq-q">What's your age range?</h3>
        <p class="mq-qhint">This helps personalize your plan.</p>

        <div class="mq-options"><button class="mq-opt" data-value="under30" data-tags="structure">Under 30</button>
          <button class="mq-opt" data-value="30-40" data-tags="hormonal structure">30-40</button>
          <button class="mq-opt" data-value="40-50" data-tags="hormonal">40-50</button>
          <button class="mq-opt" data-value="50plus" data-tags="hormonal structure">50+</button>
        </div>
      </section>
      <section class="mq-panel" data-step="8">
        <h3 class="mq-q">What‚Äôs your #1 goal?</h3>
        <p class="mq-qhint">We‚Äôll tailor your routine around this.</p>

        <div class="mq-options"><button class="mq-opt" data-value="reduce" data-tags="scalp">Reduce shedding</button>
          <button class="mq-opt" data-value="regrow" data-tags="hormonal structure">Regrow stronger hair</button>
          <button class="mq-opt" data-value="soothe" data-tags="scalp">Soothe my scalp</button>
          <button class="mq-opt" data-value="maintain" data-tags="structure">Healthy long-term routine</button>
        </div>
      </section><!-- Email capture (optional) -->

      <section class="mq-panel" data-step="email">
        <h3 class="mq-q">Want your routine sent to you?</h3>
        <p class="mq-qhint">Get your hair profile + simple weekly routine (no spam).</p>

        <div class="mq-field"><label class="mq-label" for="mq-email">Email</label>
          <input id="mq-email" class="mq-input" autocomplete="email" type="email" placeholder="you@example.com" />
        </div>
        <div class="mq-check"><input id="mq-consent" checked="checked" type="checkbox" />
          <label for="mq-consent">Yes, send me the routine &amp; Marom tips</label>
        </div>
        <div class="mq-actions"><button class="mq-btn mq-btn--primary" data-action="showResult">See my results</button>
          <button class="mq-btn mq-btn--ghost" data-action="skipEmail">Skip</button>
        </div>
        <p class="mq-footnote">You can connect this to your email platform later. For now it stores locally + you can
          capture via form/webhook if you want.</p>

      </section><!-- Results -->

      <section class="mq-panel" data-step="result">
        <div class="mq-resultTop">
          <div id="mq-result-chip" class="mq-chip">Your Result</div>
          <h2 id="mq-result-title" class="mq-h2">‚Äî</h2>
          <p id="mq-result-desc" class="mq-text">‚Äî</p>
          <!-- Loading Progress Bar -->
          <div id="mq-loading-progress" class="mq-loading-progress" style="display: none; margin-top: 20px;">
            <div class="mq-loading-bar">
              <div class="mq-loading-bar-fill"></div>
            </div>
            <p class="mq-loading-text"
              style="text-align: center; margin-top: 12px; color: rgba(1,80,48,.75); font-size: 13px; font-weight: 600;">
              Analyzing your answers...</p>

          </div>
        </div>
        <div class="mq-grid">
          <div class="mq-box">
            <h4 class="mq-h4">What this usually means</h4>
            <ul id="mq-result-meaning" class="mq-list"></ul>
          </div>
          <div class="mq-box">
            <h4 class="mq-h4">Your gentle Marom routine</h4>
            <ol id="mq-result-plan" class="mq-olist"></ol>
          </div>
        </div>
        <div class="mq-box" style="margin-top: 14px;">
          <h4 class="mq-h4">Food &amp; Nutrition Support</h4>
          <ul id="mq-result-food" class="mq-list"></ul>
        </div>
        <div id="mq-result-insights" class="mq-box" style="margin-top: 14px; display: none;">
          <h4 class="mq-h4">üí° Personalized Insights</h4>
          <p id="mq-result-insights-text" class="mq-text" style="margin: 0;"></p>

        </div>
        <div id="mq-result-products" class="mq-box" style="margin-top: 14px; display: none;">
          <h4 class="mq-h4">‚ú® Recommended Products for You</h4>
          <div id="mq-products-list" class="mq-prods"></div>
        </div>
        <div class="mq-actions" style="margin-top: 18px; justify-content: center;"><a id="mq-browse-products"
            class="mq-btn mq-btn--primary" style="color: #ffffff !important; text-decoration: none; max-width: 280px;"
            href="https://maromcosmetic.com/shop/">Browse all products</a></div>
        <p class="mq-mini" style="margin-top: 14px; text-align: center;">*Recommendations are supportive (not medical).
          If you're experiencing sudden, intense shedding, consider checking iron, thyroid, and postpartum recovery with
          a professional.</p>

        <div class="mq-actions mq-actions--end"><button class="mq-btn mq-btn--primary"
            data-action="restart">Restart</button></div>
      </section><!-- Footer nav -->
      <div class="mq-nav">

        <button class="mq-btn mq-btn--ghost mq-back" disabled="disabled" data-action="back">Back</button>
        <div id="mq-dots" class="mq-dots" aria-hidden="true"></div>
        <button class="mq-btn mq-btn--primary mq-next" disabled="disabled" data-action="next">Next</button>

      </div>
      &nbsp;

      <!-- Tiny disclaimer -->
      <p class="mq-disclaimer">MAROM Hair Balance Quiz is for education only and does not provide medical advice.</p>

    </div>
  </div>
</div>
<style>
  /* ====== MAROM Tokens (from your Elementor globals) ====== */
  <br />#marom-quiz.mq {
    <br />--mq-primary: #015030;
    <br />--mq-secondary: #FFF5D5;
    <br />--mq-text: #015030;
    <br />--mq-accent: #FDB723;
    <br />--mq-border: #FFFFFF;
    <br />--mq-dark: #222222;
    <br />--mq-light: #fafafa;
    <br />--mq-gray: #8f8f8f;
    <br />--mq-muted: #ababab;
    <br />--mq-placeholder: #b6b6b6;
    <br />--mq-soft: #F3F3F3;
    <br />--mq-font-head: "Playfair Display", "Playfair", serif;
    <br />--mq-font-body: "Montserrat", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    <br />--mq-radius-xl: 26px;
    <br />--mq-radius-lg: 18px;
    <br />--mq-radius-md: 14px;
    <br />--mq-shadow: 0 18px 60px rgba(2, 36, 22, .18);
    <br />--mq-shadow-soft: 0 10px 34px rgba(2, 36, 22, .12);
    <br />color: var(--mq-text);
    <br />font-family: var(--mq-font-body);
    <br />font-size: 15.5px;
    <br />line-height: 1.7;
    <br />
  }

  </p><p>

  /* Layout */
  <br />.mq * {
    box-sizing: border-box
  }

  <br />.mq a {
    color: inherit
  }

  <br />.mq-bg {
    <br />background: <br /> radial-gradient(1200px 800px at 10% 10%, rgba(253, 183, 35, .18), transparent 55%), <br /> radial-gradient(900px 700px at 95% 25%, rgba(1, 80, 48, .14), transparent 55%), <br /> linear-gradient(180deg, rgba(255, 245, 213, .75), rgba(250, 250, 250, .90));
    <br />padding: 24px 0;
    <br />
  }

  <br />.mq-shell {
    width: min(980px, 92vw);
    margin: 0 auto;
  }

  <br />.mq-head {
    padding: 16px 2px 18px;
  }

  <br />.mq-brand {
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--mq-primary)
  }

  <br />.mq-badge {
    <br />font-size: 12px;
    font-weight: 700;
    letter-spacing: .14em;
    <br />background: rgba(1, 80, 48, .08);
    <br />border: 1px solid rgba(1, 80, 48, .12);
    <br />padding: 6px 10px;
    border-radius: 999px;
    <br />
  }

  <br />.mq-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--mq-accent);
    display: inline-block
  }

  <br />.mq-sub {
    font-size: 13px;
    color: rgba(1, 80, 48, .82);
    font-weight: 600
  }

  </p><p>.mq-title {
    <br />font-family: var(--mq-font-head);
    <br />font-weight: 700;
    <br />line-height: 1.08;
    <br />letter-spacing: .2px;
    <br />margin: 14px 0 8px;
    <br />font-size: clamp(30px, 4.6vw, 48px);
    <br />
  }

  <br />.mq-lead {
    max-width: 62ch;
    margin: 0 0 14px;
    color: rgba(1, 80, 48, .9)
  }

  <br />.mq-progress {
    <br />height: 10px;
    <br />border-radius: 999px;
    <br />background: rgba(1, 80, 48, .10);
    <br />overflow: hidden;
    <br />border: 1px solid rgba(1, 80, 48, .12);
    <br />
  }

  <br />.mq-progress__bar {
    <br />height: 100%;
    <br />background: linear-gradient(90deg, var(--mq-accent), rgba(253, 183, 35, .72));
    <br />border-radius: 999px;
    <br />transition: width .35s ease;
    <br />
  }

  <br />.mq-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
    color: rgba(1, 80, 48, .75);
    font-weight: 600;
    font-size: 13px
  }

  </p><p>.mq-card {
    <br />background: rgba(255, 255, 255, .78);
    <br />backdrop-filter: blur(8px);
    <br />border-radius: var(--mq-radius-xl);
    <br />border: 1px solid rgba(1, 80, 48, .14);
    <br />box-shadow: var(--mq-shadow);
    <br />overflow: hidden;
    <br />
  }

  </p><p>.mq-panel {
    display: none;
    padding: 20px 18px 8px;
  }

  <br />.mq-panel--active {
    display: block;
    animation: mqIn .26s ease;
  }

  <br />@keyframes mqIn {
    <br />from {
      opacity: 0;
      transform: translateY(6px)
    }

    <br />to {
      opacity: 1;
      transform: translateY(0)
    }

    <br />
  }

  </p><p>.mq-hero {
    display: flex;
    gap: 14px;
    align-items: flex-start
  }

  <br />.mq-hero__icon {
    <br />width: 44px;
    height: 44px;
    border-radius: 14px;
    <br />background: rgba(253, 183, 35, .18);
    <br />border: 1px solid rgba(253, 183, 35, .35);
    <br />display: grid;
    place-items: center;
    color: var(--mq-primary);
    <br />flex: 0 0 auto;
    <br />
  }

  </p><p>.mq-h2 {
    <br />font-family: var(--mq-font-head);
    <br />font-size: 26px;
    <br />line-height: 1.15;
    <br />margin: 0 0 8px;
    <br />
  }

  <br />.mq-h4 {
    margin: 0 0 10px;
    font-family: var(--mq-font-head);
    font-size: 18px;
    line-height: 1.2
  }

  <br />.mq-text {
    margin: 0 0 12px;
    color: rgba(1, 80, 48, .9)
  }

  <br />.mq-bullets {
    margin: 0;
    padding-left: 18px;
    color: rgba(1, 80, 48, .86)
  }

  <br />.mq-bullets li {
    margin: 6px 0
  }

  </p><p>.mq-q {
    margin: 0 0 6px;
    font-size: 18px;
    font-weight: 700;
    letter-spacing: .1px
  }

  <br />.mq-qhint {
    margin: 0 0 14px;
    color: rgba(1, 80, 48, .72);
    font-size: 13.5px
  }

  </p><p>.mq-options {
    display: grid;
    gap: 10px;
    margin-bottom: 8px
  }

  <br />.mq-opt {
    <br />width: 100%;
    <br />text-align: left;
    <br />padding: 14px 14px;
    <br />border-radius: var(--mq-radius-lg);
    <br />border: 1px solid rgba(1, 80, 48, .14);
    <br />background: rgba(255, 255, 255, .72);
    <br />color: var(--mq-primary);
    <br />font-weight: 600;
    <br />cursor: pointer;
    <br />transition: transform .08s ease, border-color .12s ease, background .12s ease, box-shadow .12s ease;
    <br />box-shadow: 0 8px 18px rgba(2, 36, 22, .06);
    <br />
  }

  <br />.mq-opt:hover {
    <br />border-color: rgba(1, 80, 48, .14) !important;
    <br />background: rgba(255, 255, 255, .72) !important;
    <br />color: var(--mq-primary) !important;
    <br />
  }

  <br />.mq-opt:active {
    transform: scale(.99)
  }

  <br />.mq-opt[aria-selected="true"] {
    <br />border-color: rgba(253, 183, 35, .9);
    <br />background: linear-gradient(180deg, rgba(255, 245, 213, .8), rgba(255, 255, 255, .75));
    <br />box-shadow: 0 14px 28px rgba(253, 183, 35, .18);
    <br />outline: none;
    <br />
  }

  </p><p>.mq-field {
    margin: 8px 0 14px
  }

  <br />.mq-label {
    display: block;
    font-weight: 700;
    margin-bottom: 6px
  }

  <br />.mq-input {
    <br />width: 100%;
    <br />padding: 12px 12px;
    <br />border-radius: var(--mq-radius-md);
    <br />border: 1px solid rgba(1, 80, 48, .18);
    <br />background: rgba(255, 255, 255, .78);
    <br />font-family: var(--mq-font-body);
    <br />outline: none;
    <br />
  }

  <br />.mq-input::placeholder {
    color: var(--mq-placeholder)
  }

  <br />.mq-input:focus {
    border-color: rgba(253, 183, 35, .95);
    box-shadow: 0 0 0 4px rgba(253, 183, 35, .18)
  }

  </p><p>.mq-check {
    display: flex;
    gap: 10px;
    align-items: flex-start;
    color: rgba(1, 80, 48, .86);
    font-size: 13.5px
  }

  <br />.mq-check input {
    margin-top: 3px;
    accent-color: var(--mq-accent)
  }

  </p><p>.mq-actions {
    <br />display: flex;
    <br />gap: 10px;
    <br />flex-wrap: wrap;
    <br />margin-top: 14px;
    <br />align-items: center;
    <br />justify-content: center;
    <br />
  }

  <br />.mq-actions--end {
    <br />margin-top: 18px;
    <br />justify-content: center;
    <br />
  }

  <br />.mq-btn {
    <br />appearance: none;
    <br />border: none;
    <br />cursor: pointer;
    <br />border-radius: 999px;
    <br />padding: 8px 16px;
    <br />font-weight: 600;
    <br />font-family: var(--mq-font-body);
    <br />font-size: 13px;
    <br />transition: transform .08s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
    <br />white-space: nowrap;
    <br />min-width: auto;
    <br />max-width: 100%;
    <br />width: auto;
    <br />flex: 0 0 auto;
    <br />display: inline-flex;
    <br />align-items: center;
    <br />justify-content: center;
    <br />text-align: center;
    <br />box-sizing: border-box;
    <br />
  }

  <br />.mq-btn a {
    <br />display: inline-flex;
    <br />align-items: center;
    <br />justify-content: center;
    <br />width: 100%;
    <br />height: 100%;
    <br />text-decoration: none;
    <br />color: inherit;
    <br />
  }

  <br />.mq-btn:active {
    transform: scale(.99)
  }

  <br />.mq-btn--primary {
    <br />background: var(--mq-primary);
    <br />color: var(--mq-secondary);
    <br />box-shadow: 0 14px 30px rgba(1, 80, 48, .22);
    <br />
  }

  <br />.mq-btn--primary:hover {
    <br />background: var(--mq-primary) !important;
    <br />color: var(--mq-secondary) !important;
    <br />box-shadow: 0 14px 30px rgba(1, 80, 48, .22) !important;
    <br />
  }

  <br />.mq-btn--primary a,
  .mq-btn--primary a:hover,
  .mq-btn--primary a:visited {
    <br />color: #FFFFFF !important;
    <br />text-decoration: none;
    <br />
  }

  <br />.mq-btn--primary:hover a {
    <br />color: #FFFFFF !important;
    <br />
  }

  <br />#mq-browse-products,
  #mq-browse-products:hover,
  #mq-browse-products:visited {
    <br />color: #FFFFFF !important;
    <br />text-decoration: none;
    <br />display: inline-flex;
    <br />align-items: center;
    <br />justify-content: center;
    <br />white-space: nowrap;
    <br />max-width: 300px;
    <br />width: auto;
    <br />flex: 0 0 auto;
    <br />
  }

  <br />.mq-btn--ghost {
    <br />background: rgba(255, 255, 255, .70);
    <br />color: var(--mq-primary);
    <br />border: 1px solid rgba(1, 80, 48, .18);
    <br />
  }

  <br />.mq-btn--ghost:hover {
    <br />background: rgba(255, 255, 255, .70) !important;
    <br />color: var(--mq-primary) !important;
    <br />border-color: rgba(1, 80, 48, .18) !important;
    <br />
  }

  <br />.mq-btn[disabled] {
    opacity: .45;
    cursor: not-allowed;
    box-shadow: none
  }

  </p><p>

  /* Ensure selected option maintains its state even on hover */
  <br />.mq-opt[aria-selected="true"]:hover {
    <br />border-color: rgba(253, 183, 35, .9) !important;
    <br />background: linear-gradient(180deg, rgba(255, 245, 213, .8), rgba(255, 255, 255, .75)) !important;
    <br />color: var(--mq-primary) !important;
    <br />
  }

  </p><p>.mq-footnote {
    margin: 12px 0 8px;
    color: rgba(1, 80, 48, .72);
    font-size: 13px
  }

  </p><p>.mq-nav {
    <br />display: flex;
    <br />align-items: center;
    <br />justify-content: space-between;
    <br />gap: 10px;
    <br />padding: 14px 16px;
    <br />border-top: 1px solid rgba(1, 80, 48, .12);
    <br />background: rgba(255, 255, 255, .65);
    <br />
  }

  <br />.mq-back,
  .mq-next {
    <br />min-width: 80px;
    <br />max-width: 120px;
    <br />width: auto;
    <br />flex: 0 0 auto;
    <br />white-space: nowrap;
    <br />
  }

  </p><p>.mq-dots {
    display: flex;
    gap: 6px;
    align-items: center;
    justify-content: center;
    flex: 1
  }

  <br />.mq-dots span {
    <br />width: 8px;
    height: 8px;
    border-radius: 50%;
    <br />background: rgba(1, 80, 48, .18);
    <br />border: 1px solid rgba(1, 80, 48, .10);
    <br />
  }

  <br />.mq-dots span.is-on {
    background: var(--mq-accent);
    border-color: rgba(253, 183, 35, .9)
  }

  </p><p>.mq-disclaimer {
    margin: 14px 0 0;
    color: rgba(1, 80, 48, .65);
    font-size: 12.5px
  }

  </p><p>

  /* Results */
  <br />.mq-resultTop {
    padding-bottom: 10px
  }

  <br />.mq-chip {
    <br />display: inline-flex;
    align-items: center;
    gap: 8px;
    <br />padding: 7px 10px;
    <br />border-radius: 999px;
    <br />background: rgba(253, 183, 35, .16);
    <br />border: 1px solid rgba(253, 183, 35, .35);
    <br />color: var(--mq-primary);
    <br />font-weight: 800;
    <br />letter-spacing: .06em;
    <br />font-size: 12px;
    <br />text-transform: uppercase;
    <br />
  }

  <br />.mq-grid {
    display: grid;
    gap: 12px;
    margin-top: 12px
  }

  <br />.mq-box {
    <br />background: rgba(255, 255, 255, .72);
    <br />border: 1px solid rgba(1, 80, 48, .12);
    <br />border-radius: var(--mq-radius-lg);
    <br />padding: 14px;
    <br />box-shadow: var(--mq-shadow-soft);
    <br />
  }

  <br />.mq-list,
  .mq-olist {
    margin: 0;
    padding-left: 18px;
    color: rgba(1, 80, 48, .9)
  }

  <br />.mq-list li,
  .mq-olist li {
    margin: 7px 0
  }

  <br />.mq-products {
    margin-top: 14px
  }

  <br />.mq-prods {
    display: grid;
    gap: 10px;
    grid-template-columns: 1fr
  }

  <br />.mq-prod {
    <br />display: flex;
    gap: 12px;
    align-items: flex-start;
    <br />border-radius: var(--mq-radius-lg);
    <br />border: 1px solid rgba(1, 80, 48, .12);
    <br />background: rgba(255, 255, 255, .74);
    <br />padding: 12px;
    <br />box-shadow: 0 10px 22px rgba(2, 36, 22, .08);
    <br />
  }

  <br />.mq-prod__icon {
    <br />width: 44px;
    height: 44px;
    border-radius: 14px;
    <br />display: grid;
    place-items: center;
    <br />background: rgba(1, 80, 48, .08);
    <br />border: 1px solid rgba(1, 80, 48, .12);
    <br />color: var(--mq-primary);
    <br />flex: 0 0 auto;
    <br />
  }

  <br />.mq-prod__image {
    <br />width: 80px;
    <br />height: 80px;
    <br />border-radius: 14px;
    <br />overflow: hidden;
    <br />background: rgba(1, 80, 48, .05);
    <br />border: 1px solid rgba(1, 80, 48, .12);
    <br />flex: 0 0 auto;
    <br />display: flex;
    <br />align-items: center;
    <br />justify-content: center;
    <br />
  }

  <br />.mq-prod__image img {
    <br />width: 100%;
    <br />height: 100%;
    <br />object-fit: cover;
    <br />display: block;
    <br />
  }

  <br />.mq-prod__body {
    flex: 1;
    min-width: 0
  }

  <br />.mq-prod__name {
    margin: 0;
    font-weight: 800;
    line-height: 1.2
  }

  <br />.mq-prod__desc {
    margin: 4px 0 8px;
    color: rgba(1, 80, 48, .82);
    font-size: 13.5px
  }

  <br />.mq-prod__cta {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap
  }

  <br />.mq-link {
    <br />display: inline-flex;
    align-items: center;
    gap: 8px;
    <br />padding: 8px 12px;
    <br />border-radius: 999px;
    <br />background: rgba(253, 183, 35, .18);
    <br />border: 1px solid rgba(253, 183, 35, .35);
    <br />font-weight: 800;
    <br />text-decoration: none;
    <br />font-size: 13px;
    <br />
  }

  <br />.mq-link--small {
    <br />padding: 5px 10px;
    <br />font-size: 11px;
    <br />font-weight: 600;
    <br />gap: 4px;
    <br />
  }

  <br />.mq-mini {
    margin: 10px 0 0;
    color: rgba(1, 80, 48, .68);
    font-size: 12.5px
  }

  </p><p>

  /* Loading Progress Bar */
  <br />.mq-loading-progress {
    <br />margin-top: 20px;
    <br />margin-bottom: 20px;
    <br />
  }

  <br />.mq-loading-bar {
    <br />width: 100%;
    <br />height: 8px;
    <br />background: rgba(1, 80, 48, .1);
    <br />border-radius: 999px;
    <br />overflow: hidden;
    <br />position: relative;
    <br />
  }

  <br />.mq-loading-bar-fill {
    <br />height: 100%;
    <br />background: linear-gradient(90deg, var(--mq-accent), rgba(253, 183, 35, .8));
    <br />border-radius: 999px;
    <br />width: 0%;
    <br />animation: loadingProgress 2s ease-in-out infinite;
    <br />position: relative;
    <br />
  }

  <br />.mq-loading-bar-fill::after {
    <br />content: '';
    <br />position: absolute;
    <br />top: 0;
    <br />left: 0;
    <br />bottom: 0;
    <br />right: 0;
    <br />background: linear-gradient(90deg, transparent, rgba(255, 255, 255, .3), transparent);
    <br />animation: shimmer 1.5s infinite;
    <br />
  }

  <br />@keyframes loadingProgress {
    <br />0% {
      width: 0%;
    }

    <br />50% {
      width: 70%;
    }

    <br />100% {
      width: 100%;
    }

    <br />
  }

  <br />@keyframes shimmer {
    <br />0% {
      transform: translateX(-100%);
    }

    <br />100% {
      transform: translateX(100%);
    }

    <br />
  }

  <br />.mq-loading-text {
    <br />text-align: center;
    <br />margin-top: 12px;
    <br />color: rgba(1, 80, 48, .75);
    <br />font-size: 13px;
    <br />font-weight: 600;
    <br />animation: pulse 1.5s ease-in-out infinite;
    <br />
  }

  <br />@keyframes pulse {

    <br />0%,
    100% {
      opacity: 0.7;
    }

    <br />50% {
      opacity: 1;
    }

    <br />
  }

  </p><p>
  /* Responsive */
  <br />@media (max-width: 480px) {
    <br />.mq-btn {
      <br />padding: 7px 14px;
      <br />font-size: 12px;
      <br />
    }

    <br />#mq-browse-products {
      <br />max-width: 100%;
      <br />width: 100%;
      <br />
    }

    <br />.mq-actions {
      <br />flex-direction: column;
      <br />width: 100%;
      <br />
    }

    <br />.mq-actions .mq-btn {
      <br />width: 100%;
      <br />max-width: 100%;
      <br />
    }

    <br />.mq-prod__image {
      <br />width: 70px;
      <br />height: 70px;
      <br />
    }

    <br />.mq-link--small {
      <br />padding: 4px 8px;
      <br />font-size: 10px;
      <br />
    }

    <br />
  }

  </p><p>@media (min-width: 760px) {
    <br />.mq-panel {
      padding: 26px 26px 10px
    }

    <br />.mq-grid {
      grid-template-columns: 1fr 1fr
    }

    <br />.mq-prods {
      grid-template-columns: 1fr 1fr
    }

    <br />
  }

  <br />
</style>

<script>
  (function () {
    const root = document.getElementById('marom-quiz');
    if (!root) return;

    const API_URL = "https://marom-meta-backend.onrender.com/api/quiz/analyze";
    const steps = ["start", "gender", 1, 2, 3, 4, 5, 6, 7, 8, "email", "result"];
    const questionCount = 8;

    const panels = Array.from(root.querySelectorAll('.mq-panel'));
    const progress = root.querySelector('.mq-progress');
    const bar = root.querySelector('.mq-progress__bar');
    const stepText = root.querySelector('#mq-steptext');

    const btnBack = root.querySelector('[data-action="back"]');
    const btnNext = root.querySelector('[data-action="next"]');

    const dots = root.querySelector('#mq-dots');

    const state = {
      index: 0, // steps index
      answers: {}, // step -> {value,tags}
      scores: { stress: 0, hormonal: 0, scalp: 0, structure: 0 },
      goal: null,
      email: null,
      consent: true,
      gender: null // "man" or "woman"
    };

    // Build dots for 8 questions
    function buildDots() {
      dots.innerHTML = "";
      for (let i = 1; i <= questionCount; i++) { const s = document.createElement('span'); dots.appendChild(s); }
    } buildDots(); function setDots(activeStep) {
      const dotEls = Array.from(dots.children); dotEls.forEach((d, i) => {
        const stepNum = i + 1;
        d.classList.toggle('is-on', stepNum === activeStep);
      });
    }

    function setProgress() {
      const current = steps[state.index];
      let pct = 0;
      let stepNum = 0;

      if (typeof current === "number") {
        stepNum = current;
        pct = Math.round((stepNum - 1) / (questionCount) * 100);
        stepText.textContent = `Step ${stepNum} of ${questionCount}`;
        setDots(stepNum);
      } else if (current === "start") {
        pct = 0;
        stepText.textContent = `Getting started`;
        setDots(0);
      } else if (current === "gender") {
        pct = 5;
        stepText.textContent = `Step 1 of ${questionCount + 1}`;
        setDots(0);
      } else if (current === "email") {
        pct = 100;
        stepText.textContent = `Almost done`;
        setDots(questionCount);
      } else if (current === "result") {
        pct = 100;
        stepText.textContent = `Your results`;
        setDots(questionCount);
      }

      progress.setAttribute('aria-valuenow', String(pct));
      bar.style.width = pct + "%";
    }

    function showPanel(step) {
      // Hide all panels first
      panels.forEach(p => {
        p.classList.remove('mq-panel--active');
      });

      // Show panels matching step and gender (if gender is set)
      panels.forEach(p => {
        const panelStep = p.getAttribute('data-step');
        const panelGender = p.getAttribute('data-gender');

        if (panelStep == String(step)) {
          // If panel has gender attribute, only show if it matches
          if (panelGender) {
            if (panelGender === state.gender) {
              p.classList.add('mq-panel--active');
            }
          } else {
            // No gender attribute = show for all
            p.classList.add('mq-panel--active');
          }
        }
      });

      // Back/Next states
      const isQuestion = typeof step === "number";
      const isGender = step === "gender";
      btnBack.disabled = (step === "start" || state.index === 0 || step === "result");
      btnNext.style.display = (isQuestion || isGender) ? "" : "none";
      btnBack.style.display = (step === "result") ? "none" : "";

      if (isQuestion) {
        // Next is enabled only if answered
        btnNext.disabled = !state.answers[step];
        // Restore selection
        const panel = panels.find(p => {
          const panelStep = p.getAttribute('data-step');
          const panelGender = p.getAttribute('data-gender');
          return panelStep == String(step) && (!panelGender || panelGender === state.gender);
        });
        const chosen = state.answers[step]?.value;
        if (panel) {
          panel.querySelectorAll('.mq-opt').forEach(b => {
            b.setAttribute('aria-selected', String(b.dataset.value === chosen));
          });
        }
      } else if (isGender) {
        // Gender step - enable next if gender is selected
        btnNext.disabled = !state.gender;
      }
      setProgress();
    }

    function next() {
      const current = steps[state.index];
      if (typeof current === "number" && !state.answers[current]) return;
      if (current === "gender" && !state.gender) return;

      // After gender selection -> go to question 1
      if (current === "gender") {
        state.index = steps.indexOf(1);
        showPanel(1);
        return;
      }

      // After question 8 -> email step
      if (current === 8) {
        state.index = steps.indexOf("email");
        showPanel("email");
        return;
      }

      // default
      state.index = Math.min(state.index + 1, steps.length - 1);
      showPanel(steps[state.index]);
    }

    function back() {
      state.index = Math.max(state.index - 1, 0);
      showPanel(steps[state.index]);
    }

    // Scoring helpers
    function addTags(tagsStr) {
      if (!tagsStr) return;
      tagsStr.split(/\s+/).filter(Boolean).forEach(t => {
        if (state.scores[t] !== undefined) state.scores[t] += 1;
      });
    }

    function computeResult() {
      // Light weighting: postpartum answer boosts hormonal
      if (state.answers[7]?.value === "pp_yes") state.scores.hormonal += 2;
      if (state.answers[1]?.value === "postpartum") state.scores.hormonal += 2;
      if (state.answers[6]?.value === "exhausted") state.scores.stress += 1;

      // Choose max score; tie-breaker preference: hormonal > stress > scalp > structure
      const order = ["hormonal", "stress", "scalp", "structure"];
      let top = order[0], topScore = -999;
      order.forEach(k => {
        const s = state.scores[k];
        if (s > topScore) {
          topScore = s; top = k;
        } else if (s === topScore) {
          // keep earlier in order
        }
      });
      return top;
    }

    const RESULTS = {
      stress: {
        chip: "Stress Shedding Pattern",
        title: "Stress-related shedding (common in women)",
        desc: "Your answers point to a nervous-system pattern: when life is heavy, the hair cycle often pauses ‚Äî and shedding shows up weeks later.",
        meaning: [
          "Shedding often appears 4‚Äì8 weeks after stress peaks",
          "A tight, reactive scalp can reduce \"comfort\" for growth",
          "Aggressive treatments can make shedding feel worse"
        ],
        plan: [
          "Switch to gentle cleansing (focus on scalp comfort, not harsh foam)",
          "Condition lengths consistently to reduce breakage confusion",
          "Add a simple scalp-support step 3‚Äì4x/week (light, consistent)",
          "Give the routine 6‚Äì8 weeks ‚Äî consistency beats intensity"
        ],
        food: [
          "Focus on iron-rich foods (spinach, lentils, lean red meat) ‚Äî stress can deplete iron",
          "Add B-vitamin sources (eggs, whole grains, nuts) to support hair cycle",
          "Include magnesium-rich foods (dark leafy greens, almonds, seeds) to calm the nervous system",
          "Stay hydrated ‚Äî dehydration can worsen stress-related shedding",
          "Consider adaptogens like ashwagandha or rhodiola (consult a professional first)"
        ]
      },
      hormonal: {
        chip: "Hormonal Balance Pattern",
        title: "Hormonal / postpartum shedding",
        desc: "This pattern is extremely common for women ‚Äî especially postpartum or after a major body shift. The goal is gentle support, not \"shock\" treatments.",
        meaning: [
          "Postpartum shedding is often temporary (cycle reset)",
          "Harsh routines can irritate the scalp during recovery",
          "Your hair needs stability + nourishment over time"
        ],
        plan: [
          "Keep cleansing gentle and consistent (avoid over-washing)",
          "Condition lengths every wash (less breakage = less panic)",
          "Add a scalp-support serum step on clean scalp",
          "Be patient ‚Äî hair cycles need time to normalize"
        ],
        food: [
          "Prioritize protein (aim for 20-30g per meal) ‚Äî hair is made of protein",
          "Include omega-3s (salmon, walnuts, chia seeds) for scalp health",
          "Eat zinc-rich foods (pumpkin seeds, chickpeas, oysters) ‚Äî crucial for hair growth",
          "Focus on iron + vitamin C combo (lentils with bell peppers, spinach with citrus)",
          "Consider a postnatal multivitamin if postpartum (consult your doctor)",
          "Stay consistent with meals ‚Äî hormonal shifts need stable blood sugar"
        ]
      },
      scalp: {
        chip: "Scalp Sensitivity Pattern",
        title: "Scalp imbalance & sensitivity",
        desc: "Your scalp signals suggest it needs calm. A comfortable scalp often supports a better environment for healthy-looking hair over time.",
        meaning: [
          "Itch/tightness often means the scalp barrier is stressed",
          "Over-cleansing or heavy buildup can both trigger discomfort",
          "Simplifying products can be a fast win"
        ],
        plan: [
          "Use a gentle shampoo focused on scalp comfort",
          "Massage lightly (no scratching) for 60 seconds",
          "Condition lengths only (avoid heavy product at roots)",
          "Add a light scalp step only if it feels soothing (not sticky)"
        ],
        food: [
          "Reduce inflammatory foods (processed sugars, refined carbs) that can worsen scalp sensitivity",
          "Add anti-inflammatory foods (berries, fatty fish, turmeric, green tea)",
          "Include biotin-rich foods (eggs, almonds, sweet potatoes) for scalp health",
          "Stay hydrated ‚Äî dry scalp can feel tight and itchy",
          "Consider probiotics (yogurt, kefir, fermented foods) to support skin barrier health"
        ]
      },
      structure: {
        chip: "Hair Structure Pattern",
        title: "Long-term weakness & breakage confusion",
        desc: "Some of what feels like \"hair loss\" can be breakage + dryness. Strength and moisture restore the look and feel quickly ‚Äî and reduce shedding anxiety.",
        meaning: [
          "Breakage can look like hair loss (short hairs, rough ends)",
          "Dry hair tangles more ‚Üí more fall in the shower",
          "A consistent conditioning routine is key"
        ],
        plan: [
          "Cleanse gently ‚Äî don't strip and then over-compensate",
          "Condition every wash and detangle softly",
          "Use a light leave-on/scalp support step if desired",
          "Take photos every 2 weeks (progress is easier to see)"
        ],
        food: [
          "Prioritize collagen-building nutrients (vitamin C + protein) ‚Äî citrus fruits with lean meats or beans",
          "Include silica-rich foods (cucumbers, bell peppers, oats) for hair strength",
          "Eat healthy fats (avocado, olive oil, nuts) for moisture from within",
          "Add sulfur-rich foods (garlic, onions, cruciferous vegetables) for keratin production",
          "Stay hydrated ‚Äî well-hydrated hair is less prone to breakage",
          "Consider a biotin supplement if diet is limited (consult a professional)"
        ]
      }
    };

    function iconSvg(type) {
      const common = 'fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"';
      if (type === "leaf") {
        return `<svg width="22" height="22" viewBox="0 0 24 24" ${common}>
            <path d="M20 4s-7 1-11 5-5 11-5 11 7-1 11-5 5-11 5-11z"></path>
            <path d="M9 15c2-2 6-6 11-11"></path>
          </svg>`;
      }
      if (type === "spark") {
        return `<svg width="22" height="22" viewBox="0 0 24 24" ${common}>
            <path d="M12 2l1.2 4.2L17 8l-3.8 1.8L12 14l-1.2-4.2L7 8l3.8-1.8L12 2z"></path>
            <path d="M5 13l.8 2.8L8 17l-2.2 1.2L5 21l-.8-2.8L2 17l2.2-1.2L5 13z"></path>
          </svg>`;
      }
      if (type === "box") {
        return `<svg width="22" height="22" viewBox="0 0 24 24" ${common}>
            <path d="M21 8l-9-5-9 5 9 5 9-5z"></path>
            <path d="M3 8v10l9 5 9-5V8"></path>
            <path d="M12 13v10"></path>
          </svg>`;
      }
      // drop
      return `<svg width="22" height="22" viewBox="0 0 24 24" ${common}>
          <path d="M12 2s6 7 6 12a6 6 0 0 1-12 0c0-5 6-12 6-12z"></path>
        </svg>`;
    }

    function renderProducts(items) {
      const wrap = root.querySelector('#mq-prods');
      wrap.innerHTML = "";
      items.forEach(p => {
        const card = document.createElement('div');
        card.className = "mq-prod";
        card.innerHTML = `
            </p>
<p>
    </p>
<div class="mq-prod__icon" aria-hidden="true">${iconSvg(p.icon)}</div>
<p>
    </p>
<p>
            </p>
<p>
    </p>
<div class="mq-prod__body">
<p>
              </p>
<p>
    </p>
<p class="mq-prod__name">${p.name}</p>
<p>
    </p>
<p>
              </p>
<p>
    </p>
<p class="mq-prod__desc">${p.desc}</p>
<p>
    </p>
<p>
              </p>
<p>
    </p>
<div class="mq-prod__cta">
                <a class="mq-link" href="${p.link}">Shop now</a>
                <span style="color:rgba(1,80,48,.65); font-size:12.5px; font-weight:700;">Marom routine match</span>
              </div>
<p>
    </p>
<p>
            </div>
<p>
    </p>
<p>
          `;
        wrap.appendChild(card);
      });
    }

    async function renderResult() {
      // Show result panel with loading state
      showPanel("result");
      state.index = steps.indexOf("result");

      // Show loading state with progress bar
      const loadingProgress = root.querySelector('#mq-loading-progress');
      const loadingBarFill = loadingProgress.querySelector('.mq-loading-bar-fill');

      root.querySelector('#mq-result-chip').textContent = "Analyzing...";
      root.querySelector('#mq-result-title').textContent = "ü§ñ AI is analyzing your answers";
      root.querySelector('#mq-result-desc').textContent = "Creating your personalized hair care plan...";
      root.querySelector('#mq-result-meaning').innerHTML = "";
      root.querySelector('#mq-result-plan').innerHTML = "";
      root.querySelector('#mq-result-food').innerHTML = "";
      root.querySelector('#mq-result-insights').style.display = "none";
      root.querySelector('#mq-result-products').style.display = "none";

      // Show and animate loading progress bar
      loadingProgress.style.display = "block";
      loadingBarFill.style.width = "0%";
      setTimeout(() => { loadingBarFill.style.width = "30%"; }, 200);
      setTimeout(() => { loadingBarFill.style.width = "60%"; }, 800);
      setTimeout(() => { loadingBarFill.style.width = "85%"; }, 1500);

      try {
        // Call AI API
        const response = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            answers: state.answers,
            goal: state.goal,
            email: state.email,
            gender: state.gender
          })
        });

        if (!response.ok) {
          throw new Error(`API error: ${response.status}`);
        }

        const data = await response.json();

        // Complete loading animation
        loadingBarFill.style.width = "100%";
        setTimeout(() => {
          loadingProgress.style.display = "none";
        }, 300);

        if (!data.success || !data.result) {
          throw new Error("Invalid response from server");
        }

        const r = data.result;

        // Update results with AI-generated content
        root.querySelector('#mq-result-chip').textContent = r.patternName || "Your Result";
        root.querySelector('#mq-result-title').textContent = r.title || "Your Hair Analysis";
        root.querySelector('#mq-result-desc').textContent = r.description || "";

        // Meaning/insights
        const meaning = root.querySelector('#mq-result-meaning');
        meaning.innerHTML = "";
        if (r.meaning && Array.isArray(r.meaning)) {
          r.meaning.forEach(t => {
            const li = document.createElement('li');
            li.textContent = t;
            meaning.appendChild(li);
          });
        }

        // Routine plan
        const plan = root.querySelector('#mq-result-plan');
        plan.innerHTML = "";
        if (r.plan && Array.isArray(r.plan)) {
          r.plan.forEach(t => {
            const li = document.createElement('li');
            li.textContent = t;
            plan.appendChild(li);
          });
        }

        // Food/nutrition
        const food = root.querySelector('#mq-result-food');
        food.innerHTML = "";
        if (r.food && Array.isArray(r.food)) {
          r.food.forEach(t => {
            const li = document.createElement('li');
            li.textContent = t;
            food.appendChild(li);
          });
        }

        // Personalized insights
        if (r.personalizedInsights) {
          const insightsEl = root.querySelector('#mq-result-insights');
          const insightsText = root.querySelector('#mq-result-insights-text');
          insightsText.textContent = r.personalizedInsights;
          insightsEl.style.display = "block";
        }

        // Product recommendations
        if (r.products && Array.isArray(r.products) && r.products.length > 0) {
          const productsEl = root.querySelector('#mq-result-products');
          const productsList = root.querySelector('#mq-products-list');
          productsList.innerHTML = "";

          r.products.forEach(product => {
            const card = document.createElement('div');
            card.className = "mq-prod";

            // Product image
            const imageDiv = document.createElement('div');
            imageDiv.className = "mq-prod__image";
            if (product.image) {
              const img = document.createElement('img');
              img.src = product.image;
              img.alt = product.name || "Product image";
              img.loading = "lazy";
              imageDiv.appendChild(img);
            } else {
              // Fallback icon if no image
              imageDiv.className = "mq-prod__icon";
              imageDiv.setAttribute('aria-hidden', 'true');
              imageDiv.innerHTML = iconSvg("box");
            }

            const bodyDiv = document.createElement('div');
            bodyDiv.className = "mq-prod__body";

            const nameP = document.createElement('p');
            nameP.className = "mq-prod__name";
            nameP.textContent = product.name;

            const descP = document.createElement('p');
            descP.className = "mq-prod__desc";
            descP.textContent = product.reason || "Recommended for your hair pattern";

            const ctaDiv = document.createElement('div');
            ctaDiv.className = "mq-prod__cta";

            const link = document.createElement('a');
            link.className = "mq-link mq-link--small";
            link.href = product.permalink || '#';
            link.target = "_blank";
            link.textContent = "View Product";

            ctaDiv.appendChild(link);

            if (product.price) {
              const priceSpan = document.createElement('span');
              priceSpan.style.color = "rgba(1,80,48,.75)";
              priceSpan.style.fontSize = "13px";
              priceSpan.style.fontWeight = "700";
              if (product.sale_price && product.sale_price !== product.price) {
                priceSpan.textContent = `$${product.sale_price} (was $${product.price})`;
              } else {
                priceSpan.textContent = `$${product.price}`;
              }
              ctaDiv.appendChild(priceSpan);
            }

            bodyDiv.appendChild(nameP);
            bodyDiv.appendChild(descP);
            bodyDiv.appendChild(ctaDiv);

            card.appendChild(imageDiv);
            card.appendChild(bodyDiv);

            productsList.appendChild(card);
          });

          productsEl.style.display = "block";
        }

      } catch (error) {
        console.error("[Quiz] Error fetching AI results:", error);

        // Hide loading progress on error
        loadingProgress.style.display = "none";

        // Fallback to static results
        const type = computeResult();
        const r = RESULTS[type];

        root.querySelector('#mq-result-chip').textContent = r.chip;
        root.querySelector('#mq-result-title').textContent = r.title;
        root.querySelector('#mq-result-desc').textContent = r.desc;

        const meaning = root.querySelector('#mq-result-meaning');
        meaning.innerHTML = "";
        r.meaning.forEach(t => {
          const li = document.createElement('li');
          li.textContent = t;
          meaning.appendChild(li);
        });

        const plan = root.querySelector('#mq-result-plan');
        plan.innerHTML = "";
        r.plan.forEach(t => {
          const li = document.createElement('li');
          li.textContent = t;
          plan.appendChild(li);
        });

        const food = root.querySelector('#mq-result-food');
        food.innerHTML = "";
        r.food.forEach(t => {
          const li = document.createElement('li');
          li.textContent = t;
          food.appendChild(li);
        });

        // Show error message
        const errorMsg = document.createElement('p');
        errorMsg.className = "mq-mini";
        errorMsg.style.color = "rgba(239,68,68,.8)";
        errorMsg.style.marginTop = "12px";
        errorMsg.textContent = "Note: Using standard results. AI analysis unavailable.";
        root.querySelector('#mq-result-desc').parentElement.appendChild(errorMsg);
      }
    }

    function selectOption(btn) {
      const panel = btn.closest('.mq-panel');
      const step = panel.getAttribute('data-step');
      const stepNum = parseInt(step, 10);

      // Mark selected
      panel.querySelectorAll('.mq-opt').forEach(b => b.setAttribute('aria-selected', 'false'));
      btn.setAttribute('aria-selected', 'true');

      // Save
      const value = btn.dataset.value;
      const tags = btn.dataset.tags || "";

      // Handle gender selection
      if (step === "gender") {
        state.gender = value;
        // Hide all gender-specific panels, show only for selected gender
        panels.forEach(p => {
          const panelGender = p.getAttribute('data-gender');
          if (panelGender) {
            p.style.display = panelGender === value ? "" : "none";
          }
        });
        btnNext.disabled = false;
        setTimeout(() => next(), 140);
        return;
      }

      state.answers[stepNum] = { value, tags };
      addTags(tags);

      // goal capture
      if (stepNum === 8) state.goal = value;

      // enable next
      btnNext.disabled = false;

      // Auto-advance for speed (modern UX)
      setTimeout(() => next(), 140);
    }

    // Clipboard copy
    async function copyResults() {
      const type = computeResult();
      const r = RESULTS[type];
      const lines = [
        "MAROM Hair Balance Quiz ‚Äî Results",
        `Result: ${r.title}`,
        "",
        "What this means:",
        ...r.meaning.map(x => "‚Ä¢ " + x),
        "",
        "Routine:",
        ...r.plan.map((x, i) => `${i + 1}. ${x}`)
      ];
      try {
        await navigator.clipboard.writeText(lines.join("\n"));
        alert("Copied ‚úÖ");
      } catch (e) {
        alert("Copy not supported on this browser.");
      }
    }

    // Action buttons
    root.addEventListener('click', (e) => {
      const t = e.target.closest('[data-action], .mq-opt');
      if (!t) return;

      // Option click
      if (t.classList.contains('mq-opt')) {
        selectOption(t);
        return;
      }

      const action = t.getAttribute('data-action');

      if (action === "start") {
        state.index = steps.indexOf("gender");
        showPanel("gender");
      }
      if (action === "skip") {
        alert("Results are based on 4 patterns: hormonal/postpartum, stress, scalp sensitivity, or hair structure + breakage.");
      }
      if (action === "next") {
        next();
      }
      if (action === "back") {
        back();
      }
      if (action === "restart") {
        // reset
        state.index = 0;
        state.answers = {};
        state.scores = { stress: 0, hormonal: 0, scalp: 0, structure: 0 };
        state.goal = null;
        state.gender = null;
        btnNext.disabled = true;
        panels.forEach(p => {
          p.querySelectorAll('.mq-opt').forEach(b => b.setAttribute('aria-selected', 'false'));
          // Reset gender-specific panel visibility
          const panelGender = p.getAttribute('data-gender');
          if (panelGender) {
            p.style.display = "";
          }
        });
        const email = root.querySelector('#mq-email'); if (email) email.value = "";
        showPanel("start");
      }
      if (action === "copy") {
        copyResults();
      }
      if (action === "skipEmail") {
        renderResult();
      }
      if (action === "showResult") {
        const emailEl = root.querySelector('#mq-email');
        const consentEl = root.querySelector('#mq-consent');
        state.email = (emailEl?.value || "").trim();
        state.consent = !!consentEl?.checked;

        // minimal validation: if consent checked but email empty, prompt gently
        if (state.consent && !state.email) {
          emailEl.focus();
          emailEl.style.borderColor = "rgba(253,183,35,.95)";
          emailEl.style.boxShadow = "0 0 0 4px rgba(253,183,35,.18)";
          return;
        }
        renderResult();
      }
    });

    // Initialize: Hide all gender-specific panels
    panels.forEach(p => {
      const panelGender = p.getAttribute('data-gender');
      if (panelGender) {
        p.style.display = "none";
      }
    });

    // Set initial view
    showPanel("start");
  })();
</script>